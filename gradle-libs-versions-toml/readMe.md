# Example of using gradle *version catalog* with precompiled plugin scripts (buildSrc) 

__BaloKir (c)__

The project based on default gradle "Application and library project" template.
Uses gradle v 8.8

All dependencies declared inside the [libs.versions.toml](gradle/libs.versions.toml) file.

Precompiled script [buildlogic.java-common-conventions](buildSrc/src/main/kotlin/buildlogic.java-common-conventions.gradle.kts)
applies "com.adarshr.test-logger".

## How to use dependencies from libs.versions.toml

It is impossible to use dependencies in root [settings.gradle.kts](settings.gradle.kts) (not sure about others) 

We can refer `libs` dependencies in our project [build.gradle.kts](app/build.gradle.kts).
````gradle
dependencies {
    implementation(libs.commons.text)
}
````

To use dependencies from [libs.versions.toml](gradle/libs.versions.toml) in `buildSrc` precompiled scripts we need:
* declare in  [buildSrc/settings.gradle.kts](buildSrc/settings.gradle.kts) (can be generated by gradle)
  ````kotlin
    dependencyResolutionManagement {
        // Reuse version catalog from the main build.
        versionCatalogs {
            create("libs", { from(files("../gradle/libs.versions.toml")) })
        }
    }
  ````
* to be able to use `libs` in [buildSrc/build.gradle.kts](buildSrc/build.gradle.kts) 
and precompiled [script](buildSrc/src/main/kotlin/buildlogic.java-common-conventions.gradle.kts) 
we need add the `libs.versions.toml` support there:
  ````kotlin
  import org.gradle.accessors.dm.LibrariesForLibs

  private val Project.libs: LibrariesForLibs
    get() = extensions.getByType()
  ````
  and add the magic dependency into [buildSrc/build.gradle.kts](buildSrc/build.gradle.kts) 
(it resolves compilation problem with `LibrariesForLibs` in precompiled script)
  ````kotlin
      implementation(files(libs.javaClass.superclass.protectionDomain.codeSource.location))
  ````
* for gradle plugin we should declare it as a library dependency in [libs.versions.toml](gradle/libs.versions.toml) 
  ````
  [libraries]
  # These are Maven coordinates for Gradle plugins, which is necessary to use them in precompiled plugin scripts.
  # ======================================================
  # https://mvnrepository.com/artifact/com.adarshr.test-logger/com.adarshr.test-logger.gradle.plugin
  plugin-testLogger = { module = "com.adarshr.test-logger:com.adarshr.test-logger.gradle.plugin", version.ref = "testLogger" }
  ```` 
* in [buildSrc/build.gradle.kts](buildSrc/build.gradle.kts]) add dependency to plugin
  ````kotlin
      implementation(libs.plugin.testLogger)
  ````
* in precompiled [script](buildSrc/src/main/kotlin/buildlogic.java-common-conventions.gradle.kts) 
we refer the plugin by id:
  ````kotlin
  plugins {
    id("com.adarshr.test-logger")
  }
  ````
